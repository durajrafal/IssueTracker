@using IssueTracker.Application.Common.Models;
@using IssueTracker.UI.Models.Admin;

@model IEnumerable<UserDto>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h1 class="mt-3">User admin</h1>

<div class="container">
    <div class="row">
        <div class="col-xl-8">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Email</th>
                        <th scope="col">First Name</th>
                        <th scope="col">Last Name</th>
                        <th scope="col">Role</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var modelArr = Model.ToArray();
                        for (int i = 0; i < modelArr.Length; i++)
                        {
                            string id = modelArr[i].UserId;
                            string tableRowClass;
                            if (i % 2 == 0)
                            {
                                tableRowClass = "table-light";
                            }
                            else
                            {
                                tableRowClass = "table-dark";
                            }
                            <tr class="@tableRowClass" id="@id" name="table-row" data-id="@id" >
                                <td>@i</td>
                                <td>@modelArr[i].Email</td>
                                <td>@modelArr[i].FirstName</td>
                                <td>@modelArr[i].LastName</td>
                                <td>@modelArr[i].RoleClaim</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
        <div class="col-xl-4 align-items-center">
            <div id="partialViewPlaceholder">
                Please select user...
            </div>
            <div id="partialViewWithClaims">
            </div>
        </div>
    </div>
</div>



<script>
    let previouslySelectedId, previouslySelectedTableClass;

    function GetUserClaims(input) {
        $.ajax({
            type: 'GET',
            url: "@Url.Content("/Identity/Admin/GetUserClaims/")",
            data: {
                Id: input
            },
            dataType: 'html',
            success: function (result) {
                $('#partialViewWithClaims').html(result);
                document.getElementById('partialViewPlaceholder').style.display = "none";
                if (previouslySelectedId != undefined)
                {
                    let previous = document.getElementById(previouslySelectedId);
                    previous.classList.replace('table-primary', previouslySelectedTableClass);
                }
                let selected = document.getElementById(input);
                previouslySelectedTableClass = selected.classList.value;
                console.log(previouslySelectedTableClass);
                selected.classList.replace(previouslySelectedTableClass,'table-primary');
                previouslySelectedId = input;
            }
        })
    }

    let rows = document.getElementsByName("table-row");
    rows.forEach(
        function (node) {
            node.addEventListener('click', () => {
                GetUserClaims(node.dataset.id)
            });
        }
    );

</script>
